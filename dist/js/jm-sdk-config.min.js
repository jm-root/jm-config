var jm=jm||{};"undefined"!=typeof exports&&"undefined"!=typeof module&&(jm=require("jm-sdk-core"),require("jm-ms")),function(){var i=jm.sdk,t=i.storage,n=jm.ms;if(!i.config){i.on("init",function(t){t.config=t.config||{},t.config.uri=t.config.uri||t.uri,t.config.timeout=t.config.timeout||t.timeout,i.config.init(t.config)});i.config={init:function(e){var o=this;jm.enableEvent(this),e=e||{};var u=e.uri,r=e.prefix||"/config";this.uri=u+r;var c=n();o.client=c,c.use(function(i,n,e){if(i.data||(i.data={}),!i.data.token){var o=t.getItem("token")||null;o&&(i.data.token=o)}e()}),n.client({uri:this.uri,timeout:e.timeout||0},function(t,n){!t&&n&&(c.use(n),n.on("open",function(){o.emit("open"),i.emit("open","config")}),n.on("close",function(){o.emit("close"),i.emit("close","config")}))})},_getlisturi:function(i){return"/"+(i.root||"")},_geturi:function(i){var t=i.key||"";return this._getlisturi(i)+"/"+t},getConfig:function(i,t){t=t||function(){},i=i||{};var n=this._geturi(i);this.client.get({uri:n},t)},setConfig:function(i,t){t=t||function(){},i=i||{};var n=this._geturi(i);this.client.post({uri:n,data:i},t)},delConfig:function(i,t){t=t||function(){},i=i||{};var n=this._geturi(i);this.client.delete({uri:n},t)},delRoot:function(i,t){t=t||function(){},i=i||{};var n=this._getlisturi(i);this.client.delete({uri:n},t)},listConfig:function(i,t){t=t||function(){},i=i||{};var n=this._getlisturi(i);i.all&&(n+="?all=1"),this.client.get({uri:n},t)},setConfigs:function(i,t){t=t||function(){},i=i||{};var n=this._geturi(i);this.client.post({uri:n,data:i},t)}}}}();